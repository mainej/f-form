#!/usr/bin/env bash

set -Eeuo pipefail

# expects --patch, --minor, or --major
# TODO restore this when applied-science/deps-library is updated to use a
# version of workframers/garamond that uses a modern version of tools.deps.alpha
# clojure -M:release "$@"

# TODO delete this in favor of above version
msg() {
    echo >&2 -e "${1-}"
}

die() {
    local msg=$1
    local code=${2-1} # default exit status 1
    msg "$msg"
    exit "$code"
}

incr_flag=''
if [[ "${1-}" == "--patch" || "${1-}" == "--minor" || "${1-}" == "--major" ]]; then
    incr_flag="${1-}"
    shift
else
    die "Missing required parameter: --patch, --minor or --major"
fi


clojure -M:release tag "${incr_flag}" "$@"
clojure -M:release pom "$@"
clojure -Spom # fix pom, adding <optional> to vlad dep
clojure -M:release jar "$@"
clojure -M:release deploy "$@"
